<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>regitlab 使用指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .last-updated {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .step {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        code {
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "Courier New", monospace;
        }
    </style>
</head>
<body>
    <h1>regitlab 使用指南</h1>
    <p class="last-updated">最后更新日期：2026年2月</p>

    <h2>1. 初始配置</h2>
    <p>安装插件后，建议先固定扩展到浏览器工具栏，然后打开 regitlab 插件，点击右上角齿轮进入设置页面。</p>
    <h3>1.1 配置编辑器类型</h3>
    <p>选择您常用的编辑器类型（如 cursor、vscode），并填写开发项目在本地的绝对路径。用于一键复制灰度用户信息后，自动打开对应编辑器到指定文件与行号。</p>
    <p>建议不要配置，不配置时仅复制用户信息到剪贴板，不会自动打开编辑器。然后启动本地 http://localhost 页面，在插件弹窗中点击「💾 同步 udp_dev_user」，即可将用户信息注入当前页的 LocalStorage（<code>udp_dev_user</code>），便于本地使用与灰度一致的登录态。</p>
    
    <h3>1.2 配置排除分支</h3>
    <p>在「清空我的分支」前，将不允许被清除的分支名添加到「清空我的分支排除分支」中，规则：使用英文逗号分隔，最多 1000 字。</p>

    <h3>1.3 AI 日报配置</h3>
    <p>在设置页「🤖 AI 日报配置」中填写：</p>
    <ul>
        <li><strong>GitLab 邮箱</strong>：用于查询您的提交记录。（必填：如果这个邮箱不存在，则无法查询提交记录，无法配合仅展示自己的提交功能）</li>
        <li><strong>常用项目路径 (Project Path)</strong>：Group/Project 格式，如 <code>cip-economic/cost-react-1</code>，结合邮箱获取该项目下的提交记录。</li>
        <li><strong>提交记录分支</strong>：查询提交记录时使用的分支，如 <code>uat</code>。（可不填则使用默认分支）</li>
        <li><strong>Gemini API Key</strong>：用于调用 Gemini 自动生成日报内容。（可不填，则仅展示提交记录）</li>
        <li><strong>日报生成 Prompt 模板</strong>：控制生成格式与风格，最多 200 字；会自动拼接提交记录，无需在模板里重复写。（可不填则使用默认提示词）</li>
    </ul>

    <h3>1.4 显示设置</h3>
    <p>在设置页「👁️ 显示设置」中可开启：<strong>仅展示自己的提交</strong>、<strong>过滤已合并节点记录</strong>，用于在相关页面只看到自己的提交并过滤 merge 记录。（开启前检查「AI 日报配置」中的 GitLab 邮箱是否存在，否则无法查询提交记录，无法配合仅展示自己的提交功能）</p>

    <h2>2. 主要功能</h2>

    <h3>2.1 分支快速选择</h3>
    <p>在 GitLab 项目页面，插件会自动增强分支选择功能，帮助您快速切换和选择分支。</p>
    <div class="step">
        <p>在分支选择下拉框中，1表示dev，2表示uat，3表示stable-uat，4表示stable</p>
    </div>
    <p>流水线手动部署时，快速返回dev、uat、stable-uat、stable分支，供选择（原接口特别慢，且通常失败2-3次）。</p>

    <h3>2.2 创建 Pull Request / 接受 Pull Request</h3>
    <p>使用插件可以快速创建 Pull Request，自动填充相关信息，随后可以快速接受 Pull Request，简化接受流程。</p>

    <h3>2.3 生成本周/上周日报</h3>
    <p>在插件弹窗「GitLab Workflow」中点击「📅 本周日报」或「⏮ 上周日报」，会根据配置的邮箱与项目路径自动查询提交记录并展示；若已配置 Gemini API Key 与提示词，会进一步调用 Gemini 生成日报内容，支持一键复制。</p>

    <h3>2.4 运行部署流水线</h3>
    <p>在 GitLab 项目页面，可通过插件快速触发部署流水线。当前支持：<strong>成本</strong>、<strong>公共</strong>、<strong>目标</strong>、<strong>收入</strong> 四类流水线，每类均有 GRAY（灰度）与 UAT 环境，共 8 个一键触发按钮。</p>

    <h3>2.5 一键获取灰度环境用户信息（$udp.getUser）</h3>
    <p>在灰度环境页面（DCS-UAT-GRAY），点击「🔍 $udp.getUser」可一键获取当前灰度用户信息，复制到剪贴板，并根据编辑器配置打开对应编辑器到指定文件与行号。</p>

    <h3>2.6 同步 udp_dev_user 到本地</h3>
    <p>在灰度环境页面先点击「🔍 $udp.getUser」复制用户信息到剪贴板，再打开需要联调的 <code>http://localhost</code> 页面，在插件弹窗中点击「💾 同步 udp_dev_user」，即可将用户信息注入当前页的 LocalStorage（<code>udp_dev_user</code>），便于本地使用与灰度一致的登录态。</p>

    <h2>3. 自定义快捷跳转</h2>
    <p>在设置页「🔗 自定义快捷跳转」中可添加常用链接按钮，显示在插件弹窗顶部，用于快速跳转到灰度、GitLab 等常用页面。</p>
    <p>输入按钮名称（如「灰度」）和跳转链接，点击「+ 添加跳转按钮」即可。</p>
    <p>参考：可以自定义灰度的一些常用菜单的地址，快速跳转到对应页面。</p>

    <h2>4. 使用场景</h2>
    <ul>
        <li>快速创建和接受 Pull Request</li>
        <li>查看和管理个人提交记录，生成本周/上周日报</li>
        <li>自动生成工作周报（可选 Gemini 润色）</li>
        <li>快速切换 GitLab 分支（1=dev, 2=uat, 3=stable-uat, 4=stable）</li>
        <li>一键触发部署流水线（成本/公共/目标/收入 × GRAY/UAT）</li>
        <li>一键获取灰度用户信息并打开编辑器，或同步到 localhost 用于本地联调</li>
    </ul>

    <h2>5. 注意事项</h2>
    <ul>
        <li>插件在以下域名下工作：<code>https://devops.cscec.com/*</code>、<code>https://dcs-uat-gray.cscec.com/*</code>；「同步 udp_dev_user」功能还会在 <code>http://localhost/*</code> 下注入本地存储</li>
        <li>所有配置数据均存储在浏览器本地，不会上传到任何服务器</li>
        <li>使用 Gemini API 功能时，数据会发送到 Gemini 服务，请确保您已妥善保管 API Key</li>
        <li>卸载插件时，所有本地存储的数据会被清除</li>
    </ul>

    <h2>6. 常见问题</h2>
    
    <h3>Q: 插件无法正常工作？</h3>
    <p>A: 请确保您访问的是支持的 GitLab 域名，并且已正确配置邮箱和项目名称。</p>

    <h3>Q: 周报生成功能无法使用？</h3>
    <p>A: 请检查是否已正确配置 Gemini API Key，并确保网络连接正常。</p>

    <h3>Q: 如何清除所有配置？</h3>
    <p>A: 可以在插件设置页面手动删除各项配置，或卸载插件后重新安装。</p>

    <h3>Q: 「同步 udp_dev_user」提示剪切板为空？</h3>
    <p>A: 需先在灰度环境（dcs-uat-gray）页面点击「🔍 $udp.getUser」复制用户信息，再在 localhost 标签页中打开插件并点击「💾 同步 udp_dev_user」。</p>

    <hr>
    <p style="text-align: center; color: #7f8c8d; font-size: 12px; margin-top: 40px;">
        © 2026 regitlab. 保留所有权利。
    </p>
</body>
</html>

